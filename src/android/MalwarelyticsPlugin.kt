package com.wultra.malwarelytics.cordova.plugin;

import com.wultra.android.antimalware.*
import org.apache.cordova.*;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import android.content.Context;
import android.widget.Toast;

class MalwarelyticsPlugin : CordovaPlugin() {

    @Throws(JSONException::class)
    override fun execute(action: String, args: JSONArray, callbackContext: CallbackContext): Boolean {
        if (action == "initialize") {
            val username = args.getString(0)
            val password = args.getString(1)
            val signaturePublicKey = args.getString(2)
            this.initialize(username, password, signaturePublicKey, callbackContext)
            callbackContext.success("OK!")
            return true
        }
        callbackContext.error("Action does not exist.")
        return false
    }

    fun initialize(username: String, password: String, signaturePublicKey:  String, callbackContext: CallbackContext) {
        val appContext = cordova.getActivity().getApplicationContext()
        val config = AntivirusConfig.Builder(appContext)
                        .apiUsername(username)
                        .apiPassword(password)
                        .build()

        val antivirus = Antivirus.getInstance()
        antivirus.initializeAsync(config, object : Antivirus.InitializationObserver {
            override fun onInitialized() {
                Toast.makeText(appContext, "Hello!", Toast.LENGTH_LONG).show()
            }
        })
    }
}
